# miniUPnP Manager

**Author:** INotxddd / mr_sartok  
**Language:** PowerShell 5+ (Windows)  
**License:** MIT

---

## Описание
`miniUPnP Manager` — это удобный скрипт‑обёртка для `upnpc-static.exe`, позволяющий быстро управлять UPnP‑пробросом портов из командной строки Windows. В комплект входят готовые пресеты для популярных игр **Minecraft** и **Factorio**, а также интерактивный мастер для добавления собственных правил.

Скрипт автоматически скачивает и устанавливает `upnpc-static.exe` (из проекта **miniupnpc**) при первом запуске, создаёт папку `%USERPROFILE%\UPnP` и сохраняет все пользовательские настройки в файл `inot_ports.txt` (JSON).

---

## Возможности
| Функция | Описание |
|---------|----------|
| Пресет **Minecraft** | Добавляет правила 25565 TCP и 25565 UDP |
| Пресет **Factorio**  | Добавляет правило 34197 UDP |
| Пользовательские порты | Добавление / удаление / применение правил любого диапазона |
| Просмотр правил | Команда‑обёртка `upnpc -l` показывает актуальный список маппингов |
| Проверка статуса | Быстрый вызов `upnpc -s` для проверки WAN‑IP и шлюза |
| Полная очистка | Удаляет ВСЕ правила (пресеты + пользовательские) и файл настроек |

---

## Требования
- **Windows 10/11** (x64) с активным UPnP на маршрутизаторе.
- **Права администратора** для изменения сетевых правил.
- PowerShell **5.1+** или **PowerShell 7+**.
- Разрешённый запуск скриптов:  
  ```powershell
  Set-ExecutionPolicy -Scope CurrentUser RemoteSigned -Force
  ```

---

## Установка и первый запуск
1. Используйте командную строку для запуска скрипта (win+r -> cmd)
2. Введите команду:
   ```
   powershell -command "irm https://raw.githubusercontent.com/sarto4ever/UPnP-Ports-Manager/refs/heads/main/UPnP-manager.ps1 | iex"
   ```
2. При первом запуске скрипт:
   - создаст каталог `%USERPROFILE%\UPnP`;
   - скачает `upnpc-static.exe` (и связанные dll);
   - настроит внешний вид консоли (шрифт, цветовую схему);
   - откроет интерактивное меню.

> **Важно!** Если ваш роутер не поддерживает UPnP, проброс портов работать не будет.

---

## Меню управления
```
[ 1 ]  Использовать стандартные порты Minecraft
[ 2 ]  Использовать стандартные порты Factorio
[ 3 ]  Настроить свои порты
[ 4 ]  Проверить статус подключения
[ 5 ]  Показать текущие правила
[ 6 ]  Удалить все правила
[ 7 ]  Выход
```

### Быстрые пресеты
| Опция | Игра       | Порты |
|-------|------------|-------|
| 1     | Minecraft  | 25565 TCP/UDP |
| 2     | Factorio   | 34197 UDP |

Выберите пункт меню, и правила будут незамедлительно добавлены через `upnpc`.

### Пользовательские порты
1. Выберите пункт **3 «Настроить свои порты»**.
2. В интерактивном мастере доступны действия:
   - **Добавить порт** — ввод номера, выбор протокола, описание.
   - **Применить настройки** — отправить накопленные правила на роутер.
   - **Удалить порт** — убрать правило из списка и из роутера.
3. Все изменения автоматически пишутся в `%USERPROFILE%\UPnP\inot_ports.txt`.

### Проверка и просмотр
- **Статус подключения** (`upnpc -s`) показывает ваш WAN IP и шлюз.
- **Список правил** (`upnpc -l`) выводит текущие маппинги.

### Полная очистка
Пункт **6 «Удалить все правила»** вызывает функцию `Remove-AllRules`, которая:
1. Удаляет пресетные порты (Minecraft, Factorio).
2. Читает `inot_ports.txt` и удаляет все пользовательские правила.
3. Стирает `inot_ports.txt` из профиля.

---

## Удаление скрипта
1. Запустите скрипт и выберите **6 «Удалить все правила»**.
2. Удалите папку `%USERPROFILE%\UPnP`.

---

## FAQ
| Вопрос | Ответ |
| --- | --- |
| **Скрипт говорит, что UPnP не найден.** | Проверьте, включена ли функция UPnP IGD на роутере. |
| **Порты не открываются.** | Некоторые провайдеры используют CG‑NAT; в этом случае UPnP не поможет, обратитесь к провайдеру. |
| **Можно ли добавить больше игр?** | Да! Используйте пункт 3 меню или добавьте новые пресеты в функции `Set‑<Game>Ports`. |

---

## Благодарности
- **Thomas Bernard** — автор библиотеки **miniupnpc**.  
- Автор: **INotxddd** / **mr_sartok**.

---

> © 2025 mr_sartok — распространяется под лицензией MIT.
